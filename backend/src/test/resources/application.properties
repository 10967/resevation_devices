# Étape 1 : construire l'application
FROM maven:3.9.3-eclipse-temurin-21 AS build
WORKDIR /app
COPY pom.xml .
COPY src ./src
RUN mvn clean package -DskipTests

# Étape 2 : image finale avec JDK
FROM eclipse-temurin:21-jdk
WORKDIR /app
COPY --from=build /app/target/reservation-backend-1.0.jar app.jar

# Exposer le port utilisé par Spring Boot
EXPOSE 8080

# Lancer l'application avec H2 forcé
ENTRYPOINT ["java",
            "-Dspring.datasource.url=jdbc:h2:mem:testdb",
            "-Dspring.datasource.driverClassName=org.h2.Driver",
            "-Dspring.datasource.username=sa",
            "-Dspring.datasource.password=",
            "-Dspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect",
            "-Dspring.jpa.hibernate.ddl-auto=update",
            "-jar","app.jar"]
